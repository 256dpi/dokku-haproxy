#!/usr/bin/env bash
set -eo pipefail; [[ $DOKKU_TRACE ]] && set -x

# get app
APP="$1"

# log
echo "-----> Generating new haproxy configuration"

# create config
/var/lib/dokku/plugins/dokku-haproxy/create-config $APP

# concatenate configs
cat /home/dokku/haproxy/_* > /home/dokku/haproxy/haproxy.cfg

# reload config
sudo /etc/init.d/haproxy reload
